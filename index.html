<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bowl Pick'em</title>

  <style>
    /* ---------- Background ---------- */
    html { height: 100%; }

    html::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("assets/kick6.webp");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: -2;
      transform: translateZ(0);
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(246, 247, 251, 0.85);
      z-index: -1;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      margin: 0;
      color: #111;
      min-height: 100vh;
      min-height: 100svh;
      background: transparent;
    }

    @media (max-width: 768px) {
      /* show more of the top of the photo on phones */
      html::before { background-position: center 20%; }
    }

    /* ---------- Layout ---------- */
    .wrap { max-width: 900px; margin: 0 auto; padding: 24px; }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,.06);
      margin-bottom: 14px;
    }

    h1 { margin: 0 0 10px; font-size: 24px; }
    h2 { margin: 0 0 10px; font-size: 18px; }
    .sub { margin: 0 0 12px; opacity: .75; }

    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

    button {
      padding: 10px 14px;
      border: 0;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
    }

    button.primary { background: #111; color: #fff; }
    button.primary:disabled { opacity: .5; cursor: not-allowed; }

    button.ghost {
      background: rgba(17,17,17,0.08);
      color: #111;
      border: 1px solid rgba(0,0,0,0.08);
    }

    .game { display: grid; gap: 10px; }
    .meta { font-size: 13px; opacity: .75; }
    .teams { font-size: 16px; font-weight: 700; }

    .pickRow { display: flex; gap: 16px; flex-wrap: wrap; }
    label { display: flex; align-items: center; gap: 8px; }

    .ok { color: #0a7a2f; font-weight: 700; }
    .err { color: #b00020; font-weight: 700; }
    .small { font-size: 12px; opacity: .75; }

    /* ✅ Sticky header that doesn't block the background image */
    .sticky {
      position: sticky;
      top: 0;
      z-index: 5;
      padding-top: 10px;
      background: transparent;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    a.leaderboard-btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 10px;
      background: #111;
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      margin-top: 6px;
      margin-right: 8px;
    }

    .nameSelect {
      width: 320px;
      max-width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 14px;
      background: #fff;
    }

    /* ---------- "Your Picks" ---------- */
    #yourPicksCard { display: none; }
    .yourPicksList { margin: 0; padding-left: 18px; }
    .yourPicksList li { margin: 6px 0; }
    .chip {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
      font-size: 12px;
      margin-left: 8px;
      opacity: .9;
    }

    /* ---------- O/U row ---------- */
    .ouRow { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top: 6px; }
    .ouRow input[type="number"]{
      width: 140px;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 14px;
    }
    .pill {
      display:inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.06);
      font-size: 12px;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="sticky">
      <div class="card">
        <h1>College Football Bowl Pick’em 2025</h1>
        <p class="sub">Pick spreads for each game and enter an Over/Under prediction, then submit.</p>
        <p class="sub">New and improved format this year, thanks ChatGPT.</p>
        <p class="sub">Payouts tbd - will be based on total pool size.</p>

        <div class="row" style="gap:8px;">
          <a class="leaderboard-btn" href="leaderboard.html">View Spread Leaderboard</a>
          <a class="leaderboard-btn" href="ou.html">View Total Points Leaderboard</a>
        </div>

        <div class="row" style="margin-top:12px;">
          <select id="name" class="nameSelect">
            <option value="" selected disabled>Select your name…</option>
            <option>Josh</option>
            <option>James</option>
            <option>Tyler Clarke</option>
            <option>Max Fihma</option>
            <option>Maxwell</option>
            <option>Jeff &amp; Krissy</option>
            <option>Aaron B</option>
            <option>Charlie Ben-Ami</option>
            <option>Billy A</option>
            <option>Raf</option>
            <option>Jack Powers</option>
            <option>Andy Barnett</option>
            <option>Chris Barnett</option>
            <option>Austin Belcher</option>
            <option>Holly and Ellie</option>
            <option>Martig</option>
            <option>Harold</option>
            <option>olivermichaud</option>
          </select>

          <button id="submitBtn" class="primary" disabled>Submit Picks</button>
          <button id="editBtn" class="ghost" style="display:none;">Change Picks</button>
          <span id="status" class="small"></span>
        </div>
      </div>
    </div>

    <!-- ✅ Shows after submit -->
    <div id="yourPicksCard" class="card">
      <h2>Your Picks</h2>
      <p class="sub" id="yourPicksSubtitle"></p>
      <ol class="yourPicksList" id="yourPicksList"></ol>
    </div>

    <div id="games"></div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzDZv4jHUdu7t7crWX4-3GToFzvHKofDSfNANUrVyGCs0Igb3HPYWw8liHOEoIZGHKmnA/exec";

    // ✅ Replace this with your FULL list. Important: every game MUST have a unique id.
    // Optional: include ouLine if you want to display sportsbook total.
    const GAMES = [
      { id: "cotton-bowl-2025-12-31", date: "Dec 31, 2025", bowl: "Cotton Bowl",
        team1: "Miami (FL)", team2: "Ohio State", spread1: "+9.5", spread2: "-9.5", ouLine: "Current Total Line is 41.5" },

      { id: "orange-bowl-2026-01-01", date: "Jan 1, 2026", bowl: "Orange Bowl",
        team1: "Oregon", team2: "Texas Tech", spread1: "-2.5", spread2: "+2.5", ouLine: "Current Total Line is 51.5" },

      { id: "rose-bowl-2026-01-01", date: "Jan 1, 2026", bowl: "Rose Bowl",
        team1: "Alabama", team2: "Indiana", spread1: "+7", spread2: "-7", ouLine: "Current Total Line is 47.5" },

      { id: "sugar-bowl-2026-01-01", date: "Jan 1, 2026", bowl: "Sugar Bowl",
        team1: "Ole Miss", team2: "UGA", spread1: "+6.5", spread2: "-6.5", ouLine: "Current Total Line is 55.5" },
    ];

    const elGames = document.getElementById("games");
    const elName = document.getElementById("name");
    const elBtn = document.getElementById("submitBtn");
    const elEdit = document.getElementById("editBtn");
    const elStatus = document.getElementById("status");

    const elYourPicksCard = document.getElementById("yourPicksCard");
    const elYourPicksSubtitle = document.getElementById("yourPicksSubtitle");
    const elYourPicksList = document.getElementById("yourPicksList");

    const picks = {};   // gameId -> pickedTeam
    const ouPicks = {}; // gameId -> number
    let locked = false;

    function escapeHtml(s) {
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    function render() {
      elGames.innerHTML = "";

      for (const g of GAMES) {
        const card = document.createElement("div");
        card.className = "card game";

        const t1Label = `${g.team1} ${g.spread1 || ""}`.trim();
        const t2Label = `${g.team2} ${g.spread2 || ""}`.trim();

        const groupName = `pick-${g.id}`;
        const ouId = `ou-${g.id}`;

        const ouHint = (g.ouLine !== undefined && g.ouLine !== null && g.ouLine !== "")
          ? `<span class="pill">Line: ${escapeHtml(g.ouLine)}</span>`
          : "";

        card.innerHTML = `
          <div class="meta">${escapeHtml(g.date)} - ${escapeHtml(g.bowl)}</div>
          <div class="teams">${escapeHtml(g.team1)} vs ${escapeHtml(g.team2)}</div>

          <div class="pickRow">
            <label>
              <input type="radio" name="${groupName}" value="${escapeHtml(g.team1)}">
              ${escapeHtml(t1Label)}
            </label>
            <label>
              <input type="radio" name="${groupName}" value="${escapeHtml(g.team2)}">
              ${escapeHtml(t2Label)}
            </label>
          </div>

          <div class="ouRow">
            <label for="${ouId}" style="font-weight:700;">O/U prediction</label>
            <input id="${ouId}" type="number" step="0.5" inputmode="decimal" placeholder="Enter Total Points">
            ${ouHint}
          </div>
        `;

        elGames.appendChild(card);

        // Restore spread selection (if any)
        const selected = picks[g.id];
        if (selected) {
          const sel = card.querySelector(`input[value="${CSS.escape(selected)}"]`);
          if (sel) sel.checked = true;
        }

        // Spread listeners
        card.querySelectorAll(`input[name="${CSS.escape(groupName)}"]`).forEach(inp => {
          inp.disabled = locked;
          inp.addEventListener("change", e => {
            picks[g.id] = e.target.value;
            validate();
          });
        });

        // Restore O/U (if any) + listeners
        const ouInput = card.querySelector(`#${CSS.escape(ouId)}`);
        if (ouInput) {
          if (ouPicks[g.id] !== undefined) ouInput.value = ouPicks[g.id];
          ouInput.disabled = locked;

          ouInput.addEventListener("input", (e) => {
            const v = e.target.value;
            ouPicks[g.id] = (v === "" ? undefined : Number(v));
            validate();
          });
        }
      }

      validate();
    }

    function validate() {
      const nameOk = elName.value.trim().length > 0;
      const allPicked = GAMES.every(g => picks[g.id]);
      const allOuFilled = GAMES.every(g => typeof ouPicks[g.id] === "number" && Number.isFinite(ouPicks[g.id]));
      const urlOk = SCRIPT_URL && SCRIPT_URL.startsWith("https://script.google.com/") && SCRIPT_URL.endsWith("/exec");

      elBtn.disabled = locked || !(nameOk && allPicked && allOuFilled && urlOk);

      elStatus.textContent =
        !urlOk ? "Fix SCRIPT_URL (must end with /exec)." :
        !nameOk ? "Select your name." :
        !allPicked ? "Pick every game." :
        !allOuFilled ? "Enter a total points prediction for every game." :
        "";

      elStatus.className = "small";
    }

    function setLocked(isLocked) {
      locked = isLocked;
      elName.disabled = isLocked;
      elEdit.style.display = isLocked ? "" : "none";
      render();
    }

    function showYourPicks() {
      const name = elName.value.trim();
      elYourPicksSubtitle.textContent = `${name} — here’s what you submitted.`;

      elYourPicksList.innerHTML = GAMES.map(g => {
        const matchup = `${g.team1} vs ${g.team2}`;
        const pick = picks[g.id] || "—";
        const ou = (typeof ouPicks[g.id] === "number") ? ouPicks[g.id] : "—";
        return `<li>
          <strong>${escapeHtml(matchup)}</strong>
          <span class="chip">${escapeHtml(pick)}</span>
          <span class="chip">O/U: ${escapeHtml(ou)}</span>
        </li>`;
      }).join("");

      elYourPicksCard.style.display = "";
      elYourPicksCard.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    elName.addEventListener("change", validate);

    elEdit.addEventListener("click", () => {
      elYourPicksCard.style.display = "none";
      elStatus.textContent = "Edit your picks, then re-submit.";
      elStatus.className = "small";
      setLocked(false);
    });

    elBtn.addEventListener("click", async () => {
      elBtn.disabled = true;
      elStatus.textContent = "Submitting…";
      elStatus.className = "small";

      const payload = { name: elName.value.trim(), picks, ouPicks };

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));
        if (!data.ok) throw new Error(data.error || "Submission failed");

        elStatus.textContent = "Submitted! ✅";
        elStatus.className = "ok";

        setLocked(true);
        showYourPicks();
      } catch (err) {
        elStatus.textContent = "Error: " + err.message;
        elStatus.className = "err";
        validate();
      }
    });

    render();
  </script>
</body>
</html>
